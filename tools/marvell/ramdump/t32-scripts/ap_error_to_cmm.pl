#!/usr/bin/perl

$toolname = "ap_error_to_cmm.pl";
if ($#ARGV < 0) {
  &Usage;
  exit;
}

$infile = shift;
open (in,	"$infile")       || die "Can't open $infile for reading";

my $i = 0;
do {
	$line = <in>;
	if ($line =~ /^[0-9a-f]+/) {
		chomp($line);
		@regs[$i..$i+7] = split(' ',  $line);
		$i+=8;
	} else {
		print "; $line";
	}
} until !defined($line);
print "\n; Register values generated by $toolname from $infile\n";
print "r.set cpsr 0x$regs[16]\n";
for $i (0..14) {
	print "r.set r$i 0x$regs[$i]\n";
}
print "r.set pc 0x$regs[15]\n";

exit(0);

sub Usage() {
	print "perl $toolname ap_error.log\n";
	print "generates the cmm fragment and prints it to stdout\n"
}
